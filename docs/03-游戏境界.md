# 天下MUD - 游戏境界系统

## 技能系统核心

**核心文件**: `/feature/skill.c`

## 技能等级系统

### 等级上限机制

- **基础上限**: 50级
- **提升条件**: 通过积累技能经验 (learned) 来提升技能等级
- **计算公式**: `learned[skill] > (skills[skill] + 1) * (skills[skill] + 1)`

### 技能经验累积

**Learned Mapping**:
- 每次使用技能都会增加 learned 值
- 当 learned 值达到要求时，技能等级自动提升
- 不同技能有不同的经验累积速度

**示例**:
```
技能1级 → 2级: 需要 learned > (1+1)*(1+1) = 4
技能2级 → 3级: 需要 learned > (2+1)*(2+1) = 9
技能3级 → 4级: 需要 learned > (3+1)*(3+1) = 16
...
技能10级 → 11级: 需要 learned > (10+1)*(10+1) = 121
```

## 技能映射系统 (Skill Map)

### 基本概念

技能映射允许将基础技能映射到高级武功，使用高级武功时会同时提升基础技能的经验。

**示例**:
- 将 "unarmed" (基础拳法) 映射到 "luohan-quan" (罗汉拳)
- 使用罗汉拳时，会同时提升拳法和罗汉拳的经验

### 映射规则

```c
skill_map(基础技能, 高级武功)
```

## 武功境界系统

### 少林易筋经加成系统

**特殊机制**: 少林弟子修炼易筋经可获得额外武功威力加成

**加成计算公式**:
```c
if(yjj["level"] <= 2)
    return yjj["level"];  // 1-2重: 直接加成

if(yjj["level"] <= 9)
    return 2 + (yjj["level"] - 2) * 2;  // 3-9重: 2 + (重数-2)*2

return 16 + (yjj["level"] - 9) * 10;  // 10+重: 16 + (重数-9)*10
```

**境界对应加成**:
- 1重: +1
- 2重: +2
- 3重: +4
- 4重: +6
- 5重: +8
- 6重: +10
- 7重: +12
- 8重: +14
- 9重: +16
- 10重: +26
- 11重: +36
- 12重: +46

## 经验系统

### 战斗经验 (Combat Experience)

**字段名**: `combat_exp`

**作用**:
1. 衡量角色战斗经验和整体实力
2. 影响技能学习上限
3. 决定可以挑战的NPC难度
4. 影响任务奖励
5. 门派晋升的重要指标

### 经验等级对照

根据探索到的NPC数据，可以推测经验等级大致如下：

- **新手**: 0 - 10,000
- **入门**: 10,000 - 50,000
- **初窥门径**: 50,000 - 100,000
- **小有所成**: 100,000 - 200,000
- **江湖好手**: 200,000 - 400,000 (如少林空正)
- **一流高手**: 400,000 - 800,000 (如唐门师傅)
- **绝顶高手**: 800,000 - 2,000,000
- **武林宗师**: 2,000,000 - 5,000,000
- **传说人物**: 5,000,000+ (如风清扬 7,000,000)

## 技能学习系统

### 学习途径

1. **拜师学艺**
   - 加入门派，向师傅学习
   - 需要满足前置技能要求
   - 需要支付学费或完成任务

2. **研读秘籍**
   - 获得武功秘籍后可自行研读
   - 需要具备一定的悟性 (int)
   - 需要具备读书识字技能 (literate)

3. **实战磨练**
   - 通过战斗自动提升 learned 值
   - 战斗越艰难，经验增长越快

4. **特殊传授**
   - 某些绝学需要特殊条件
   - 如华山独孤九剑需要高悟性且不能学华山剑法
   - 需要通过"比划"实战学习

## 技能类别与境界

### 内功心法

**境界划分** (推测):
- 初学: 1-30级
- 小成: 31-60级
- 大成: 61-100级
- 圆满: 101-150级
- 登峰造极: 151-200级
- 返璞归真: 201-250级
- 天人合一: 251-300级

### 招式武功

**效果等级** (Effective Level):
- 不同武功有不同的 effective_level
- 数值越高，威力越大
- 常见范围: 8-13

**示例**:
- 少林罗汉拳: effective_level = 12
- 华山独孤九剑: effective_level = 11 (攻击), 13 (防御)
- 唐门飞雪连天: effective_level = 12

## 武功修炼要求

### 前置技能要求

大多数高级武功都需要满足前置技能要求：

**少林罗汉拳示例**:
```
需要: 长拳 100级
需要: 易气诀 100级
```

**华山独孤九剑示例**:
```
需要: 悟性 31+
限制: 不能学过华山剑法
```

### 属性要求

某些武功对角色属性有要求：
- **力量 (str)**: 影响拳掌、刀剑威力
- **悟性 (int)**: 影响学习速度和上限
- **根骨 (con)**: 影响内功修炼
- **身法 (dex)**: 影响轻功和闪避

## 门派世代系统

### 世代机制

**系统文件**: `/feature/apprentice.c`

**功能**: `create_family(门派名, 世代, 称号)`

### 世代显示规则

- **第1代**: "开山祖师"
- **其他世代**: "第X代XXX"

### 世代示例

**少林寺**:
- 第37代弟子 (空字辈)

**华山派**:
- 第2代: 风清扬 (师叔)
- 第3代: 岳不群 (掌门)
- 第4代: 令狐冲 (掌门师兄)

**唐门**:
- 第16代长老

**丐帮**:
- 第5代 (X袋长老)

**踏雪山庄**:
- 第1-2代

## 修炼境界总结

### 武学之路

1. **入门期** (0-100级)
   - 学习基础技能
   - 积累战斗经验
   - 选择门派路线

2. **成长期** (100-200级)
   - 掌握门派武功
   - 提升战斗经验
   - 学习高级招式

3. **精进期** (200-300级)
   - 武功大成
   - 挑战高级NPC
   - 寻求绝学传承

4. **宗师期** (300+级)
   - 武学登峰造极
   - 收徒传艺
   - 创立自己的武学流派

### 成就目标

- 战斗经验达到百万级别
- 掌握门派所有绝学
- 技能等级突破300级
- 成为一代武林宗师

## 特殊境界系统

### 少林禅定

- 通过禅定提升悟性
- 修炼大乘佛法
- 领悟佛门真谛

### 华山剑意

- 剑宗专精剑法
- 气宗专精内功
- 两者不可兼修

### 唐门毒功

- 毒术等级影响毒药效果
- 需要配合医术使用
- 可炼制各种毒药

这个境界系统为玩家提供了清晰的成长路径和长期目标，使游戏具有持久的吸引力。
